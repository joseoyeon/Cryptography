김지연, 김형종, 강성주 (2014), 사이버 물리 시스템을 위한 실시간 시뮬레이션 기술 개발, 한국 시뮬레이션 학회 논문, 23(4), 181-188

## 초록

CPS 환경에서는 모델의 복잡도가 높을 경우, 다른 모델과의 시간 오차로 인해 잘못된 데이터 및 제어 명령을 전송할 수 있다.

이를 해결하기 위해 시간 동기화 알고리즘을 제시한다.

## 서론

사이버 물리 시스템(cyber-physical-system, CPS)는 네트워크를 통해 물리 시스템과 연산 체계를 통합함으로써 

물리 프로세스와 상호작용을 할 수 있는 컴퓨팅 시스템이다.

CPS 는 분산 환경에 존재하는 시스템 간의 상호작용이 요규되기 때문에 만일 시스템 간의 오차가 발생하는 경우, 

잘못된 제어 명령에 의해 위험이 초래될 수 있다. 

## 관련 연구

1. Conservative 알고리즘

인과관계가 만족 되지 않으면 그 조건이 만족될 때 까지 기다렸다가 시뮬레이션을 진행하는 보수적인 시간 진행 방법

![image](https://user-images.githubusercontent.com/46625602/63910569-408b7d80-ca62-11e9-86b6-56374ae98e2a.png)

 lookahead = 프로세스가 메시지(m)를 받은 현재 시간(t)와 다음 메시지를 받을 시간(t')과의 차이 
 
 프로세스 1은 시간 t'에 프로세스 2와 3에 메시지를 보낸다. 
 
 프로세스 2,3은 t'시간 후의 작업을 먼저 실행 하지 않고 기다려야 한다.
 
 조건이 만족할 때 까지 기다리는 알고리즘이 conservative 알고리즘, 보수 알고리즘이다.
 
2. Optimistic 알고리즘 

최적화 알고리즘은 메시지가 도착하는 즉시 처리하고,

인과 관계를 만족하지 않는 상황이 발생되면 롤백(rollback)을 진행 한다. 

![image](https://user-images.githubusercontent.com/46625602/63911867-ca3d4a00-ca66-11e9-9d84-24b4798b2588.png)

프로세스 2,3은 t'를 고려하지 않고 작업을 하다가 t'에 수행될 작업이 들어 오면 롤백한다음 다시 되돌려서

메시지를 다시 처리한다. 

롤백 과정은 과거 이벤트가 발생한 시간으로 시뮬레이션 시간을 설정하는 과정(restoration),

이전 상태를 취소 시키는 과정(cancellation),

새로운 시간을 적용하여 다시 시뮬레이션을 진행 시키는 과정(coasting forward)

를 사용한다. 

## CPS 시간 동기화 알고리즘 설계

![image](https://user-images.githubusercontent.com/46625602/63912047-7da63e80-ca67-11e9-83ba-cae740ee1ec1.png)

이 논문의 요지는 연속 모델의 연산주기(time step)을 조절해서 시간 동기화를 달성한다. 

기준 : 절대적인 시간을 의미하는 글로벌 시간 데이터를 기준으로 시뮬레이션 실시간 여부를 판단

실시간 동기화를 위해서는 새로운 연산 주기를 갱신하는 과정이 필요하다 .

> 연속 모델의 초기 연산 주기(T~initTS~) = 0.1
> 글로벌 시간 수신 간격 (T~initGT~) = 1

모든 시뮬레이터의 각 연산 주기중 가장 긴 연산주기보다 길게 설정해야 

각 시뮬레이터가 1번의 연산 주기 동안 여러번 글로벌 시간을 수신한다는 것을 방지할 수 있다. 

이 논문에서 개발한 연산주기 갱신 방법이다.

![image](https://user-images.githubusercontent.com/46625602/63912656-96632400-ca68-11e9-91b5-e7b1f86a9e80.png)


수식 (1)에서 R(ratio)은 **한 번의 글로벌 수신 간격 동안 몇 번의 연산이 일어나는지**를 나타낸다.

실시간과의 오차를 나타내는 E (error)는 **현재 시뮬레이션 시간과 현재 글로벌 시간의 차이**로 계산하며 

수식 (1)과 (2)를 통해 얻은 값은 궁극적으로 새로운 연산 주기를 결정하는 데에 활용된다. 

새로운 연산 주기는 수식 (3)과 같이 **글로벌 시간 수신 간격과 오차 범위 내에서 몇 번에 걸쳐 연산을 수행할 것인지**를 판단하여 갱신할 수 있다.

![image](https://user-images.githubusercontent.com/46625602/63912988-931c6800-ca69-11e9-9d99-91289f516f53.png)


![image](https://user-images.githubusercontent.com/46625602/63913139-f7d7c280-ca69-11e9-8c81-287a68579de6.png)

